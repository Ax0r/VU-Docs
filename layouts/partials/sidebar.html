{{- $currentNode := . }}
<div id="td-sidebar-menu" class="td-sidebar__inner">
  {{ if not .Site.Params.ui.sidebar_search_disable }}
  <form class="td-sidebar__search d-flex align-items-center">
    {{ partial "search-input.html" . }}
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  {{ end }}
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3">
      <li class="td-sidebar-nav__section-title">
        <a  href="{{ .Site.Home.RelPermalink }}" class="align-left pl-0 pr-2{{ if .IsHome}} active{{ end }} td-sidebar-link td-sidebar-link__section">{{ .Site.Home.LinkTitle }}</a>
      </li>
      <ul>
        {{- if eq .Site.Params.ordersectionsby "title"}}
          {{- range .Site.Home.Sections.ByTitle}}
          {{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
          {{- end}}
        {{- else}}
          {{- range .Site.Home.Sections.ByWeight}}
          {{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
          {{- end}}
        {{- end}}
      </ul>
    </ul>
  </nav>
</div>

<!-- templates -->
{{- define "section-tree-nav" }}
{{- $showvisitedlinks := .showvisitedlinks }}
{{- $currentNode := .currentnode }}
 {{- with .sect }}
  {{- if .IsSection }}
    {{- $active := eq . $currentNode.CurrentSection }}
    {{- $numberOfPages := (add (len .Pages) (len .Sections)) }}
    <ul class="td-sidebar-nav__section pr-md-3">
      <li class="td-sidebar-nav__section-title">
        <a href="{{ .RelPermalink }}" class="align-left pl-0 pr-2{{ if $active }} active{{end}}">{{ .LinkTitle }}</a>
      </li>
      {{- if and (ne $numberOfPages 0) (not .Params.hideChildren) }}
        <ul>
          {{- .Scratch.Set "pages" .Pages }}
          {{- if .Sections}}
          {{- .Scratch.Set "pages" (.Pages | union .Sections) }}
          {{- end}}
          {{- $pages := (.Scratch.Get "pages") }}
          {{- range $pages.ByWeight }}
            {{- template "section-tree-nav" dict "sect" . "currentnode" $currentNode }}
          {{- end}}
        </ul>
      {{- end}}
    </ul>
  {{- else}}
    {{- $active := eq .URL $currentNode.URL }}
    <li>
        <a class="td-sidebar-link td-sidebar-link__page{{ if $active }} active{{end}}" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
    </li>
  {{- end}}
 {{- end}}
{{- end}}